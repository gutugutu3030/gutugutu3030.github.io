<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>gutugutu3030</title>

    <!-- PWA: Web App Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- PWA: Theme color -->
    <meta name="theme-color" content="#212529">

    <!-- PWA: iOS Safari 対応 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Portfolio">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">

    <script type="text/javascript" src="/main.bundle.js"></script>

    <!-- PWA: Service Worker 登録（本番環境のみ） -->
    <script>
        if ('serviceWorker' in navigator) {
            if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                // 開発環境: 登録済みの SW をすべて解除して HMR が壊れないようにする
                navigator.serviceWorker.getRegistrations().then(function(regs) {
                    regs.forEach(function(reg) { reg.unregister(); });
                });
            } else {
                // 本番環境のみ SW を登録
                // updateViaCache: 'none' で SW 自体の HTTP キャッシュを無視させ
                // デプロイ後すぐに新しい sw.js を検出できるようにする
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('/sw.js', { updateViaCache: 'none' })
                        .then(function(reg) {
                            console.log('SW registered:', reg.scope);
                            // 新しい SW がインストール完了したらページを自動リロード
                            reg.addEventListener('updatefound', function() {
                                var newSW = reg.installing;
                                if (!newSW) return;
                                newSW.addEventListener('statechange', function() {
                                    if (newSW.state === 'activated' && navigator.serviceWorker.controller) {
                                        console.log('New SW activated, reloading for update...');
                                        window.location.reload();
                                    }
                                });
                            });
                        })
                        .catch(function(err) { console.warn('SW registration failed:', err); });
                });
            }
        }
    </script>
</head>
<body>
<div id="kvapp"></div>
</body>
</html>
